cmake_minimum_required(VERSION 3.10.2 FATAL_ERROR)
project(IlluminationEngine)

set(CMAKE_CXX_LINKER_PREFERENCE)
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/bin)
set(CMAKE_LIBRARY_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/lib)
if (((NOT EXISTS ${CMAKE_SOURCE_DIR}/deps) OR ${CMAKE_SOURCE_DIR}/deps.tar.xz IS_NEWER_THAN ${CMAKE_SOURCE_DIR}/deps) AND CMAKE_BUILD_TYPE STREQUAL Debug)
    if (EXISTS ${CMAKE_SOURCE_DIR}/deps)
        file(RENAME ${CMAKE_SOURCE_DIR}/deps ${CMAKE_SOURCE_DIR}/dep)
    endif ()
    file(REMOVE_RECURSE ${CMAKE_SOURCE_DIR}/dep)
    message("Unpacking dependencies tarball...")
    file(ARCHIVE_EXTRACT INPUT ${CMAKE_SOURCE_DIR}/deps.tar.xz DESTINATION ${CMAKE_SOURCE_DIR}/dep)
    file(RENAME ${CMAKE_SOURCE_DIR}/dep/deps ${CMAKE_SOURCE_DIR}/deps)
    file(REMOVE_RECURSE ${CMAKE_SOURCE_DIR}/dep)
    file(TOUCH_NOCREATE ${CMAKE_SOURCE_DIR}/deps)
elseif (CMAKE_BUILD_TYPE STREQUAL Release)
    while (NOT EXISTS ${CMAKE_SOURCE_DIR}/deps)
    endwhile ()
    message("Found unpacked dependencies")
endif ()
file(COPY ${CMAKE_SOURCE_DIR}/res DESTINATION ${CMAKE_BINARY_DIR}/bin)
if (UNIX)
    set(BUILD_SHARED_LIBS ON CACHE BOOL "" FORCE)
else ()
    set(BUILD_SHARED_LIBS OFF CACHE BOOL "" FORCE)
endif ()

if (CMAKE_BUILD_TYPE STREQUAL Debug)
    add_compile_options("-g")
else ()
    add_compile_options("-O3")
endif ()

add_subdirectory(src)