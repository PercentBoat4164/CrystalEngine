add_custom_target(IEGraphicsModuleMergedShaders)
set(IEDefaultMergedShaders
        ${CMAKE_CURRENT_SOURCE_DIR}/DEBUGNormals.frag)
find_program(GLSLC glslc glslc.exe)
if (GLSLC)
    file(MAKE_DIRECTORY ${CMAKE_BINARY_DIR}/bin/shaders/Merged)
    foreach (shader ${IEDefaultMergedShaders})
        if (CMAKE_BUILD_TYPE STREQUAL Release)
            add_custom_command(OUTPUT "${shader}.spv" COMMAND ${GLSLC} --target-env=vulkan1.2 ${shader} -o "${shader}.spv" DEPENDS ${shader} COMMENT "Compiling ${shader} in Release mode.")
        else ()
            add_custom_command(OUTPUT "${shader}.spv" COMMAND ${GLSLC} --target-env=vulkan1.2 ${shader} -o "${shader}.spv" -g DEPENDS ${shader} COMMENT "Compiling ${shader} in Debug mode.")
        endif ()
        target_sources(IEGraphicsModuleMergedShaders PRIVATE "${shader}.spv")
        add_custom_command(TARGET IEGraphicsModuleMergedShaders COMMAND ${CMAKE_COMMAND} -E copy "${shader}.spv" ${CMAKE_BINARY_DIR}/bin/shaders/Merged DEPENDS "${shader}.spv")
        add_custom_command(TARGET IEGraphicsModuleMergedShaders COMMAND ${CMAKE_COMMAND} -E copy "${shader}" ${CMAKE_BINARY_DIR}/bin/shaders/Merged DEPENDS "${shader}")
    endforeach ()
endif ()